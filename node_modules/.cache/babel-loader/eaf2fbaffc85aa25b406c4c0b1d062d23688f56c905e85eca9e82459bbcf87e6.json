{"ast":null,"code":"import{apiFetch}from'./api';export const authStorage={load(){try{const raw=localStorage.getItem('auth');return raw?JSON.parse(raw):{user:null,accessToken:null,refreshToken:null};}catch{return{user:null,accessToken:null,refreshToken:null};}},save(state){localStorage.setItem('auth',JSON.stringify(state));},clear(){localStorage.removeItem('auth');}};export async function register(payload){var _data;const res=await apiFetch('/api/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});let data=null;try{data=await res.json();}catch{}if(!res.ok)throw new Error(((_data=data)===null||_data===void 0?void 0:_data.message)||'Registration failed');return data;}export async function login(payload){var _data$data,_data$data2,_data$data3;const res=await apiFetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(!res.ok)throw new Error('Login failed');const data=await res.json();const state={user:(data===null||data===void 0?void 0:(_data$data=data.data)===null||_data$data===void 0?void 0:_data$data.user)||null,accessToken:(data===null||data===void 0?void 0:(_data$data2=data.data)===null||_data$data2===void 0?void 0:_data$data2.access_token)||null,refreshToken:(data===null||data===void 0?void 0:(_data$data3=data.data)===null||_data$data3===void 0?void 0:_data$data3.refresh_token)||null};authStorage.save(state);return state;}export async function refresh(accessState){var _data$data4,_data$data5;if(!accessState.refreshToken)throw new Error('No refresh token');const res=await apiFetch('/api/auth/refresh',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({refresh_token:accessState.refreshToken})});if(!res.ok)throw new Error('Refresh failed');const data=await res.json();const newState={user:(data===null||data===void 0?void 0:(_data$data4=data.data)===null||_data$data4===void 0?void 0:_data$data4.user)||accessState.user,accessToken:(data===null||data===void 0?void 0:(_data$data5=data.data)===null||_data$data5===void 0?void 0:_data$data5.access_token)||null,refreshToken:accessState.refreshToken};authStorage.save(newState);return newState;}export async function getProfile(accessToken){const res=await apiFetch('/api/auth/profile',{headers:{'Authorization':`Bearer ${accessToken}`}});if(!res.ok)throw new Error('Profile fetch failed');return res.json();}export async function logout(accessState){const res=await apiFetch('/api/auth/logout',{method:'POST',headers:{'Content-Type':'application/json',...(accessState.accessToken?{'Authorization':`Bearer ${accessState.accessToken}`}:{})},body:JSON.stringify({refresh_token:accessState.refreshToken})});if(!res.ok)throw new Error('Logout failed');authStorage.clear();}","map":{"version":3,"names":["apiFetch","authStorage","load","raw","localStorage","getItem","JSON","parse","user","accessToken","refreshToken","save","state","setItem","stringify","clear","removeItem","register","payload","_data","res","method","headers","body","data","json","ok","Error","message","login","_data$data","_data$data2","_data$data3","access_token","refresh_token","refresh","accessState","_data$data4","_data$data5","newState","getProfile","logout"],"sources":["C:/Users/Selecty/Documents/PetProjects/chronoline-frontend/src/services/auth.ts"],"sourcesContent":["import { apiFetch } from './api';\r\n\r\nexport interface AuthUser {\r\n  id: number;\r\n  email: string;\r\n  username?: string;\r\n  full_name?: string;\r\n  avatar_url?: string;\r\n  role: string;\r\n  email_verified: boolean;\r\n}\r\n\r\nexport interface AuthState {\r\n  user: AuthUser | null;\r\n  accessToken: string | null;\r\n  refreshToken: string | null;\r\n}\r\n\r\nexport const authStorage = {\r\n  load(): AuthState {\r\n    try {\r\n      const raw = localStorage.getItem('auth');\r\n      return raw ? JSON.parse(raw) : { user: null, accessToken: null, refreshToken: null };\r\n    } catch {\r\n      return { user: null, accessToken: null, refreshToken: null };\r\n    }\r\n  },\r\n  save(state: AuthState) {\r\n    localStorage.setItem('auth', JSON.stringify(state));\r\n  },\r\n  clear() {\r\n    localStorage.removeItem('auth');\r\n  }\r\n};\r\n\r\nexport async function register(payload: { email: string; password: string; username?: string; full_name?: string; }) {\r\n  const res = await apiFetch('/api/auth/register', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  let data: any = null;\r\n  try { data = await res.json(); } catch {}\r\n  if (!res.ok) throw new Error(data?.message || 'Registration failed');\r\n  return data;\r\n}\r\n\r\nexport async function login(payload: { email: string; password: string; }) {\r\n  const res = await apiFetch('/api/auth/login', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  if (!res.ok) throw new Error('Login failed');\r\n  const data = await res.json();\r\n  const state: AuthState = {\r\n    user: data?.data?.user || null,\r\n    accessToken: data?.data?.access_token || null,\r\n    refreshToken: data?.data?.refresh_token || null\r\n  };\r\n  authStorage.save(state);\r\n  return state;\r\n}\r\n\r\nexport async function refresh(accessState: AuthState) {\r\n  if (!accessState.refreshToken) throw new Error('No refresh token');\r\n  const res = await apiFetch('/api/auth/refresh', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ refresh_token: accessState.refreshToken })\r\n  });\r\n  if (!res.ok) throw new Error('Refresh failed');\r\n  const data = await res.json();\r\n  const newState: AuthState = {\r\n    user: data?.data?.user || accessState.user,\r\n    accessToken: data?.data?.access_token || null,\r\n    refreshToken: accessState.refreshToken\r\n  };\r\n  authStorage.save(newState);\r\n  return newState;\r\n}\r\n\r\nexport async function getProfile(accessToken: string) {\r\n  const res = await apiFetch('/api/auth/profile', {\r\n    headers: { 'Authorization': `Bearer ${accessToken}` }\r\n  });\r\n  if (!res.ok) throw new Error('Profile fetch failed');\r\n  return res.json();\r\n}\r\n\r\nexport async function logout(accessState: AuthState) {\r\n  const res = await apiFetch('/api/auth/logout', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json', ...(accessState.accessToken ? { 'Authorization': `Bearer ${accessState.accessToken}` } : {}) },\r\n    body: JSON.stringify({ refresh_token: accessState.refreshToken })\r\n  });\r\n  if (!res.ok) throw new Error('Logout failed');\r\n  authStorage.clear();\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}