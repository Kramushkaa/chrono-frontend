{"ast":null,"code":"import{useState,useEffect,useMemo,useCallback}from'react';import{getPersons,getCategories,getCountries}from'../services/api';export const useTimelineData=filters=>{const[persons,setPersons]=useState([]);const[allCategories,setAllCategories]=useState([]);const[allCountries,setAllCountries]=useState([]);const[isLoading,setIsLoading]=useState(true);// Мемоизируем параметры фильтров для предотвращения лишних запросов\nconst filtersToApply=useMemo(()=>{const filtersToApply={startYear:filters.timeRange.start,endYear:filters.timeRange.end};if(filters.categories.length>0){filtersToApply.category=filters.categories.join(',');}if(filters.countries.length>0){filtersToApply.country=filters.countries.join(',');}return filtersToApply;},[filters.categories,filters.countries,filters.timeRange.start,filters.timeRange.end]);// Мемоизируем функцию загрузки данных\nconst fetchData=useCallback(async()=>{try{setIsLoading(true);// Загружаем персон с учетом фильтров\nconst personsData=await getPersons(filtersToApply);setPersons(personsData);// Загружаем категории и страны только если они еще не загружены\nif(allCategories.length===0||allCountries.length===0){const[categoriesData,countriesData]=await Promise.all([getCategories(),getCountries()]);setAllCategories(categoriesData);setAllCountries(countriesData);}}catch(error){console.error(\"Ошибка при загрузке данных:\",error);}finally{setIsLoading(false);}},[filtersToApply,allCategories.length,allCountries.length]);useEffect(()=>{fetchData();},[fetchData]);return{persons,allCategories,allCountries,isLoading};};","map":{"version":3,"names":["useState","useEffect","useMemo","useCallback","getPersons","getCategories","getCountries","useTimelineData","filters","persons","setPersons","allCategories","setAllCategories","allCountries","setAllCountries","isLoading","setIsLoading","filtersToApply","startYear","timeRange","start","endYear","end","categories","length","category","join","countries","country","fetchData","personsData","categoriesData","countriesData","Promise","all","error","console"],"sources":["C:/Users/Selecty/Documents/PetProjects/chronoline-frontend/src/hooks/useTimelineData.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useCallback } from 'react'\r\nimport { Person } from '../types'\r\nimport { getPersons, getCategories, getCountries } from '../services/api'\r\n\r\ninterface Filters {\r\n  categories: string[]\r\n  countries: string[]\r\n  timeRange: { start: number; end: number }\r\n  showAchievements: boolean\r\n}\r\n\r\nexport const useTimelineData = (filters: Filters) => {\r\n  const [persons, setPersons] = useState<Person[]>([])\r\n  const [allCategories, setAllCategories] = useState<string[]>([])\r\n  const [allCountries, setAllCountries] = useState<string[]>([])\r\n  const [isLoading, setIsLoading] = useState(true)\r\n\r\n  // Мемоизируем параметры фильтров для предотвращения лишних запросов\r\n  const filtersToApply = useMemo(() => {\r\n    const filtersToApply: {\r\n      category?: string;\r\n      country?: string;\r\n      startYear: number;\r\n      endYear: number;\r\n    } = {\r\n      startYear: filters.timeRange.start,\r\n      endYear: filters.timeRange.end\r\n    }\r\n    \r\n    if (filters.categories.length > 0) {\r\n      filtersToApply.category = filters.categories.join(',')\r\n    }\r\n    if (filters.countries.length > 0) {\r\n      filtersToApply.country = filters.countries.join(',')\r\n    }\r\n    \r\n    return filtersToApply\r\n  }, [filters.categories, filters.countries, filters.timeRange.start, filters.timeRange.end])\r\n\r\n  // Мемоизируем функцию загрузки данных\r\n  const fetchData = useCallback(async () => {\r\n    try {\r\n      setIsLoading(true)\r\n\r\n      // Загружаем персон с учетом фильтров\r\n      const personsData = await getPersons(filtersToApply)\r\n      setPersons(personsData)\r\n\r\n      // Загружаем категории и страны только если они еще не загружены\r\n      if (allCategories.length === 0 || allCountries.length === 0) {\r\n        const [categoriesData, countriesData] = await Promise.all([\r\n          getCategories(),\r\n          getCountries()\r\n        ])\r\n        setAllCategories(categoriesData)\r\n        setAllCountries(countriesData)\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Ошибка при загрузке данных:\", error)\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [filtersToApply, allCategories.length, allCountries.length])\r\n\r\n  useEffect(() => {\r\n    fetchData()\r\n  }, [fetchData])\r\n\r\n  return { persons, allCategories, allCountries, isLoading }\r\n} "],"mappings":"AAAA,OAASA,QAAQ,CAAEC,SAAS,CAAEC,OAAO,CAAEC,WAAW,KAAQ,OAAO,CAEjE,OAASC,UAAU,CAAEC,aAAa,CAAEC,YAAY,KAAQ,iBAAiB,CASzE,MAAO,MAAM,CAAAC,eAAe,CAAIC,OAAgB,EAAK,CACnD,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGV,QAAQ,CAAW,EAAE,CAAC,CACpD,KAAM,CAACW,aAAa,CAAEC,gBAAgB,CAAC,CAAGZ,QAAQ,CAAW,EAAE,CAAC,CAChE,KAAM,CAACa,YAAY,CAAEC,eAAe,CAAC,CAAGd,QAAQ,CAAW,EAAE,CAAC,CAC9D,KAAM,CAACe,SAAS,CAAEC,YAAY,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CAEhD;AACA,KAAM,CAAAiB,cAAc,CAAGf,OAAO,CAAC,IAAM,CACnC,KAAM,CAAAe,cAKL,CAAG,CACFC,SAAS,CAAEV,OAAO,CAACW,SAAS,CAACC,KAAK,CAClCC,OAAO,CAAEb,OAAO,CAACW,SAAS,CAACG,GAC7B,CAAC,CAED,GAAId,OAAO,CAACe,UAAU,CAACC,MAAM,CAAG,CAAC,CAAE,CACjCP,cAAc,CAACQ,QAAQ,CAAGjB,OAAO,CAACe,UAAU,CAACG,IAAI,CAAC,GAAG,CAAC,CACxD,CACA,GAAIlB,OAAO,CAACmB,SAAS,CAACH,MAAM,CAAG,CAAC,CAAE,CAChCP,cAAc,CAACW,OAAO,CAAGpB,OAAO,CAACmB,SAAS,CAACD,IAAI,CAAC,GAAG,CAAC,CACtD,CAEA,MAAO,CAAAT,cAAc,CACvB,CAAC,CAAE,CAACT,OAAO,CAACe,UAAU,CAAEf,OAAO,CAACmB,SAAS,CAAEnB,OAAO,CAACW,SAAS,CAACC,KAAK,CAAEZ,OAAO,CAACW,SAAS,CAACG,GAAG,CAAC,CAAC,CAE3F;AACA,KAAM,CAAAO,SAAS,CAAG1B,WAAW,CAAC,SAAY,CACxC,GAAI,CACFa,YAAY,CAAC,IAAI,CAAC,CAElB;AACA,KAAM,CAAAc,WAAW,CAAG,KAAM,CAAA1B,UAAU,CAACa,cAAc,CAAC,CACpDP,UAAU,CAACoB,WAAW,CAAC,CAEvB;AACA,GAAInB,aAAa,CAACa,MAAM,GAAK,CAAC,EAAIX,YAAY,CAACW,MAAM,GAAK,CAAC,CAAE,CAC3D,KAAM,CAACO,cAAc,CAAEC,aAAa,CAAC,CAAG,KAAM,CAAAC,OAAO,CAACC,GAAG,CAAC,CACxD7B,aAAa,CAAC,CAAC,CACfC,YAAY,CAAC,CAAC,CACf,CAAC,CACFM,gBAAgB,CAACmB,cAAc,CAAC,CAChCjB,eAAe,CAACkB,aAAa,CAAC,CAChC,CACF,CAAE,MAAOG,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,6BAA6B,CAAEA,KAAK,CAAC,CACrD,CAAC,OAAS,CACRnB,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CAAC,CAAE,CAACC,cAAc,CAAEN,aAAa,CAACa,MAAM,CAAEX,YAAY,CAACW,MAAM,CAAC,CAAC,CAE/DvB,SAAS,CAAC,IAAM,CACd4B,SAAS,CAAC,CAAC,CACb,CAAC,CAAE,CAACA,SAAS,CAAC,CAAC,CAEf,MAAO,CAAEpB,OAAO,CAAEE,aAAa,CAAEE,YAAY,CAAEE,SAAU,CAAC,CAC5D,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}