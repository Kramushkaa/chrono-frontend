{"ast":null,"code":"import { apiFetch } from './api';\nexport const authStorage = {\n  load() {\n    try {\n      const raw = localStorage.getItem('auth');\n      return raw ? JSON.parse(raw) : {\n        user: null,\n        accessToken: null,\n        refreshToken: null\n      };\n    } catch {\n      return {\n        user: null,\n        accessToken: null,\n        refreshToken: null\n      };\n    }\n  },\n  save(state) {\n    localStorage.setItem('auth', JSON.stringify(state));\n  },\n  clear() {\n    localStorage.removeItem('auth');\n  }\n};\nexport async function register(payload) {\n  const res = await apiFetch('/api/auth/register', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(payload)\n  });\n  if (!res.ok) throw new Error('Registration failed');\n  return res.json();\n}\nexport async function login(payload) {\n  var _data$data, _data$data2, _data$data3;\n  const res = await apiFetch('/api/auth/login', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(payload)\n  });\n  if (!res.ok) throw new Error('Login failed');\n  const data = await res.json();\n  const state = {\n    user: (data === null || data === void 0 ? void 0 : (_data$data = data.data) === null || _data$data === void 0 ? void 0 : _data$data.user) || null,\n    accessToken: (data === null || data === void 0 ? void 0 : (_data$data2 = data.data) === null || _data$data2 === void 0 ? void 0 : _data$data2.access_token) || null,\n    refreshToken: (data === null || data === void 0 ? void 0 : (_data$data3 = data.data) === null || _data$data3 === void 0 ? void 0 : _data$data3.refresh_token) || null\n  };\n  authStorage.save(state);\n  return state;\n}\nexport async function refresh(accessState) {\n  var _data$data4, _data$data5;\n  if (!accessState.refreshToken) throw new Error('No refresh token');\n  const res = await apiFetch('/api/auth/refresh', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      refresh_token: accessState.refreshToken\n    })\n  });\n  if (!res.ok) throw new Error('Refresh failed');\n  const data = await res.json();\n  const newState = {\n    user: (data === null || data === void 0 ? void 0 : (_data$data4 = data.data) === null || _data$data4 === void 0 ? void 0 : _data$data4.user) || accessState.user,\n    accessToken: (data === null || data === void 0 ? void 0 : (_data$data5 = data.data) === null || _data$data5 === void 0 ? void 0 : _data$data5.access_token) || null,\n    refreshToken: accessState.refreshToken\n  };\n  authStorage.save(newState);\n  return newState;\n}\nexport async function getProfile(accessToken) {\n  const res = await apiFetch('/api/auth/profile', {\n    headers: {\n      'Authorization': `Bearer ${accessToken}`\n    }\n  });\n  if (!res.ok) throw new Error('Profile fetch failed');\n  return res.json();\n}\nexport async function logout(accessState) {\n  const res = await apiFetch('/api/auth/logout', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      ...(accessState.accessToken ? {\n        'Authorization': `Bearer ${accessState.accessToken}`\n      } : {})\n    },\n    body: JSON.stringify({\n      refresh_token: accessState.refreshToken\n    })\n  });\n  if (!res.ok) throw new Error('Logout failed');\n  authStorage.clear();\n}","map":{"version":3,"names":["apiFetch","authStorage","load","raw","localStorage","getItem","JSON","parse","user","accessToken","refreshToken","save","state","setItem","stringify","clear","removeItem","register","payload","res","method","headers","body","ok","Error","json","login","_data$data","_data$data2","_data$data3","data","access_token","refresh_token","refresh","accessState","_data$data4","_data$data5","newState","getProfile","logout"],"sources":["C:/Users/Selecty/Documents/PetProjects/chronoline-frontend/src/services/auth.ts"],"sourcesContent":["import { apiFetch } from './api';\r\n\r\nexport interface AuthUser {\r\n  id: number;\r\n  email: string;\r\n  username?: string;\r\n  full_name?: string;\r\n  avatar_url?: string;\r\n  role: string;\r\n  email_verified: boolean;\r\n}\r\n\r\nexport interface AuthState {\r\n  user: AuthUser | null;\r\n  accessToken: string | null;\r\n  refreshToken: string | null;\r\n}\r\n\r\nexport const authStorage = {\r\n  load(): AuthState {\r\n    try {\r\n      const raw = localStorage.getItem('auth');\r\n      return raw ? JSON.parse(raw) : { user: null, accessToken: null, refreshToken: null };\r\n    } catch {\r\n      return { user: null, accessToken: null, refreshToken: null };\r\n    }\r\n  },\r\n  save(state: AuthState) {\r\n    localStorage.setItem('auth', JSON.stringify(state));\r\n  },\r\n  clear() {\r\n    localStorage.removeItem('auth');\r\n  }\r\n};\r\n\r\nexport async function register(payload: { email: string; password: string; username?: string; full_name?: string; }) {\r\n  const res = await apiFetch('/api/auth/register', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  if (!res.ok) throw new Error('Registration failed');\r\n  return res.json();\r\n}\r\n\r\nexport async function login(payload: { email: string; password: string; }) {\r\n  const res = await apiFetch('/api/auth/login', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  if (!res.ok) throw new Error('Login failed');\r\n  const data = await res.json();\r\n  const state: AuthState = {\r\n    user: data?.data?.user || null,\r\n    accessToken: data?.data?.access_token || null,\r\n    refreshToken: data?.data?.refresh_token || null\r\n  };\r\n  authStorage.save(state);\r\n  return state;\r\n}\r\n\r\nexport async function refresh(accessState: AuthState) {\r\n  if (!accessState.refreshToken) throw new Error('No refresh token');\r\n  const res = await apiFetch('/api/auth/refresh', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ refresh_token: accessState.refreshToken })\r\n  });\r\n  if (!res.ok) throw new Error('Refresh failed');\r\n  const data = await res.json();\r\n  const newState: AuthState = {\r\n    user: data?.data?.user || accessState.user,\r\n    accessToken: data?.data?.access_token || null,\r\n    refreshToken: accessState.refreshToken\r\n  };\r\n  authStorage.save(newState);\r\n  return newState;\r\n}\r\n\r\nexport async function getProfile(accessToken: string) {\r\n  const res = await apiFetch('/api/auth/profile', {\r\n    headers: { 'Authorization': `Bearer ${accessToken}` }\r\n  });\r\n  if (!res.ok) throw new Error('Profile fetch failed');\r\n  return res.json();\r\n}\r\n\r\nexport async function logout(accessState: AuthState) {\r\n  const res = await apiFetch('/api/auth/logout', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json', ...(accessState.accessToken ? { 'Authorization': `Bearer ${accessState.accessToken}` } : {}) },\r\n    body: JSON.stringify({ refresh_token: accessState.refreshToken })\r\n  });\r\n  if (!res.ok) throw new Error('Logout failed');\r\n  authStorage.clear();\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}