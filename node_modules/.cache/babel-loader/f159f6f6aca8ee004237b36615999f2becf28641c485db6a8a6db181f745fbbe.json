{"ast":null,"code":"import { apiFetch } from './api';\nexport const authStorage = {\n  load() {\n    try {\n      const raw = localStorage.getItem('auth');\n      return raw ? JSON.parse(raw) : {\n        user: null,\n        accessToken: null,\n        refreshToken: null\n      };\n    } catch {\n      return {\n        user: null,\n        accessToken: null,\n        refreshToken: null\n      };\n    }\n  },\n  save(state) {\n    localStorage.setItem('auth', JSON.stringify(state));\n  },\n  clear() {\n    localStorage.removeItem('auth');\n  }\n};\nexport async function register(payload) {\n  var _data;\n  const res = await apiFetch('/api/auth/register', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(payload)\n  });\n  let data = null;\n  try {\n    data = await res.json();\n  } catch {}\n  if (!res.ok) throw new Error(((_data = data) === null || _data === void 0 ? void 0 : _data.message) || 'Registration failed');\n  return data;\n}\nexport async function login(payload) {\n  var _data$data, _data$data2, _data$data3;\n  const res = await apiFetch('/api/auth/login', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(payload)\n  });\n  if (!res.ok) throw new Error('Login failed');\n  const data = await res.json();\n  const state = {\n    user: (data === null || data === void 0 ? void 0 : (_data$data = data.data) === null || _data$data === void 0 ? void 0 : _data$data.user) || null,\n    accessToken: (data === null || data === void 0 ? void 0 : (_data$data2 = data.data) === null || _data$data2 === void 0 ? void 0 : _data$data2.access_token) || null,\n    refreshToken: (data === null || data === void 0 ? void 0 : (_data$data3 = data.data) === null || _data$data3 === void 0 ? void 0 : _data$data3.refresh_token) || null\n  };\n  authStorage.save(state);\n  return state;\n}\nexport async function refresh(accessState) {\n  var _data$data4, _data$data5;\n  if (!accessState.refreshToken) throw new Error('No refresh token');\n  const res = await apiFetch('/api/auth/refresh', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      refresh_token: accessState.refreshToken\n    })\n  });\n  if (!res.ok) throw new Error('Refresh failed');\n  const data = await res.json();\n  const newState = {\n    user: (data === null || data === void 0 ? void 0 : (_data$data4 = data.data) === null || _data$data4 === void 0 ? void 0 : _data$data4.user) || accessState.user,\n    accessToken: (data === null || data === void 0 ? void 0 : (_data$data5 = data.data) === null || _data$data5 === void 0 ? void 0 : _data$data5.access_token) || null,\n    refreshToken: accessState.refreshToken\n  };\n  authStorage.save(newState);\n  return newState;\n}\nexport async function getProfile(accessToken) {\n  const res = await apiFetch('/api/auth/profile', {\n    headers: {\n      'Authorization': `Bearer ${accessToken}`\n    }\n  });\n  if (!res.ok) throw new Error('Profile fetch failed');\n  return res.json();\n}\nexport async function logout(accessState) {\n  const res = await apiFetch('/api/auth/logout', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      ...(accessState.accessToken ? {\n        'Authorization': `Bearer ${accessState.accessToken}`\n      } : {})\n    },\n    body: JSON.stringify({\n      refresh_token: accessState.refreshToken\n    })\n  });\n  if (!res.ok) throw new Error('Logout failed');\n  authStorage.clear();\n}\nexport async function updateProfile(accessToken, payload) {\n  const res = await apiFetch('/api/auth/profile', {\n    method: 'PUT',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${accessToken}`\n    },\n    body: JSON.stringify(payload)\n  });\n  const data = await res.json().catch(() => null);\n  if (!res.ok) throw new Error((data === null || data === void 0 ? void 0 : data.message) || 'Profile update failed');\n  return data;\n}\nexport async function changePassword(accessToken, payload) {\n  const res = await apiFetch('/api/auth/change-password', {\n    method: 'PUT',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${accessToken}`\n    },\n    body: JSON.stringify(payload)\n  });\n  const data = await res.json().catch(() => null);\n  if (!res.ok) throw new Error((data === null || data === void 0 ? void 0 : data.message) || 'Password change failed');\n  return data;\n}","map":{"version":3,"names":["apiFetch","authStorage","load","raw","localStorage","getItem","JSON","parse","user","accessToken","refreshToken","save","state","setItem","stringify","clear","removeItem","register","payload","_data","res","method","headers","body","data","json","ok","Error","message","login","_data$data","_data$data2","_data$data3","access_token","refresh_token","refresh","accessState","_data$data4","_data$data5","newState","getProfile","logout","updateProfile","catch","changePassword"],"sources":["C:/Users/Selecty/Documents/PetProjects/chronoline-frontend/src/services/auth.ts"],"sourcesContent":["import { apiFetch } from './api';\r\n\r\nexport interface AuthUser {\r\n  id: number;\r\n  email: string;\r\n  username?: string;\r\n  full_name?: string;\r\n  avatar_url?: string;\r\n  role: string;\r\n  email_verified: boolean;\r\n}\r\n\r\nexport interface AuthState {\r\n  user: AuthUser | null;\r\n  accessToken: string | null;\r\n  refreshToken: string | null;\r\n}\r\n\r\nexport const authStorage = {\r\n  load(): AuthState {\r\n    try {\r\n      const raw = localStorage.getItem('auth');\r\n      return raw ? JSON.parse(raw) : { user: null, accessToken: null, refreshToken: null };\r\n    } catch {\r\n      return { user: null, accessToken: null, refreshToken: null };\r\n    }\r\n  },\r\n  save(state: AuthState) {\r\n    localStorage.setItem('auth', JSON.stringify(state));\r\n  },\r\n  clear() {\r\n    localStorage.removeItem('auth');\r\n  }\r\n};\r\n\r\nexport async function register(payload: { email: string; password: string; username?: string; full_name?: string; }) {\r\n  const res = await apiFetch('/api/auth/register', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  let data: any = null;\r\n  try { data = await res.json(); } catch {}\r\n  if (!res.ok) throw new Error(data?.message || 'Registration failed');\r\n  return data;\r\n}\r\n\r\nexport async function login(payload: { email: string; password: string; }) {\r\n  const res = await apiFetch('/api/auth/login', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  if (!res.ok) throw new Error('Login failed');\r\n  const data = await res.json();\r\n  const state: AuthState = {\r\n    user: data?.data?.user || null,\r\n    accessToken: data?.data?.access_token || null,\r\n    refreshToken: data?.data?.refresh_token || null\r\n  };\r\n  authStorage.save(state);\r\n  return state;\r\n}\r\n\r\nexport async function refresh(accessState: AuthState) {\r\n  if (!accessState.refreshToken) throw new Error('No refresh token');\r\n  const res = await apiFetch('/api/auth/refresh', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ refresh_token: accessState.refreshToken })\r\n  });\r\n  if (!res.ok) throw new Error('Refresh failed');\r\n  const data = await res.json();\r\n  const newState: AuthState = {\r\n    user: data?.data?.user || accessState.user,\r\n    accessToken: data?.data?.access_token || null,\r\n    refreshToken: accessState.refreshToken\r\n  };\r\n  authStorage.save(newState);\r\n  return newState;\r\n}\r\n\r\nexport async function getProfile(accessToken: string) {\r\n  const res = await apiFetch('/api/auth/profile', {\r\n    headers: { 'Authorization': `Bearer ${accessToken}` }\r\n  });\r\n  if (!res.ok) throw new Error('Profile fetch failed');\r\n  return res.json();\r\n}\r\n\r\nexport async function logout(accessState: AuthState) {\r\n  const res = await apiFetch('/api/auth/logout', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json', ...(accessState.accessToken ? { 'Authorization': `Bearer ${accessState.accessToken}` } : {}) },\r\n    body: JSON.stringify({ refresh_token: accessState.refreshToken })\r\n  });\r\n  if (!res.ok) throw new Error('Logout failed');\r\n  authStorage.clear();\r\n}\r\n\r\nexport async function updateProfile(accessToken: string, payload: { username?: string; full_name?: string; avatar_url?: string; }) {\r\n  const res = await apiFetch('/api/auth/profile', {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${accessToken}` },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  const data = await res.json().catch(() => null);\r\n  if (!res.ok) throw new Error(data?.message || 'Profile update failed');\r\n  return data;\r\n}\r\n\r\nexport async function changePassword(accessToken: string, payload: { current_password: string; new_password: string; }) {\r\n  const res = await apiFetch('/api/auth/change-password', {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${accessToken}` },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  const data = await res.json().catch(() => null);\r\n  if (!res.ok) throw new Error(data?.message || 'Password change failed');\r\n  return data;\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}